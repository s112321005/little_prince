<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>貓貓星球</title>
<style>
    body{margin:0;padding:0;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#d6cc98;font-family:sans-serif;overflow:hidden;}
    body {
        margin: 0;
        overflow: hidden;
        background-image: url("https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=2000&q=80");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }
    #gameWrapper{display:flex;flex-direction:column;align-items:center;width:100%;max-width:500px;}
    #container{position:relative;width:420px;height:420px;overflow:visible;margin:0 auto;}
    .planet{position:absolute;width:140px;height:140px;border-radius:50%;display:flex;align-items:center;justify-content:center;overflow:visible;border:3px solid #fff;box-shadow:0 4px 10px rgba(0,0,0,.2);}
    .planet img{width:100%;height:100%;object-fit:cover;border-radius:50%;}
    svg{position:absolute;top:0;left:0;width:100%;height:100%;}
    line{stroke:#555;stroke-width:5;cursor:pointer;transition:stroke .3s;}
    line:hover{stroke:#000;}
    .person{width:90px;height:90px;object-fit:contain;pointer-events:none;transition:transform .8s ease;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);}
    #info{display:flex;flex-direction:column;align-items:center;margin-top:15px;width:100%;}
    #steps{font-size:1.5rem;font-weight:bold;color:#333;}
    #timer{font-size:1.2rem;color:#444;margin-top:5px;}
    #buttons{display:flex;justify-content:center;gap:10px;margin-top:15px;width:100%;}
    #resetBtn{padding:8px 16px;background:#7a654f;color:#fff;border:none;border-radius:8px;font-size:1rem;cursor:pointer;}
    #resetBtn:hover{background:#5c4d3a;}
    #prevBtn,#nextBtn{width:50px;height:50px;border-radius:50%;border:none;background:#f1f1f1b1;color:#7a654f;font-size:1.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .3s;}
    #prevBtn:hover,#nextBtn:hover{background:#5c4d3a;color:#fff;}
    #prevBtn::before,#nextBtn::before{content:"";display:block;width:0;height:0;border:12px solid transparent;position:absolute;}
    #prevBtn::before{border-right-color:#7a654f;margin-left:-5px;}
    #nextBtn::before{border-left-color:#7a654f;margin-left:5px;}
    #prevBtn:hover::before{border-right-color:#fff;}
    #nextBtn:hover::before{border-left-color:#fff;}
    @media(max-width:768px){#container{width:380px;height:380px;}.planet{width:120px;height:120px;}.person{width:80px;height:80px;}}
    .slide-out-left{animation:slideOutLeft .6s forwards;}
    .slide-in-right{animation:slideInRight .6s forwards;}
    .slide-out-right{animation:slideOutRight .6s forwards;}
    .slide-in-left{animation:slideInLeft .6s forwards;}
    @keyframes slideOutLeft{from{transform:translateX(0);opacity:1}to{transform:translateX(-100%);opacity:0}}
    @keyframes slideInRight{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes slideOutRight{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}
    @keyframes slideInLeft{from{transform:translateX(-100%);opacity:0}to{transform:translateX(0);opacity:1}}
    .popup{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:1000;animation:fadeIn .3s ease;}
    .popup-content{background:#fff;border-radius:20px;padding:30px 40px;text-align:center;box-shadow:0 5px 20px rgba(0,0,0,.3);animation:popUp .4s ease;max-width:90%;}
    .popup-content h2{margin:8px 0 10px;}
    .popup-content button{background:#ffb60b;color:#fff;border:none;border-radius:12px;padding:10px 20px;cursor:pointer;font-size:16px;transition:background .2s;}
    .popup-content button:hover{background:#ff750b;}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes popUp{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
    .left-panel{position:absolute;left:10px;top:50px;width:220px;background:rgba(255,255,255,.92);backdrop-filter:blur(10px);border-radius:16px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.12);font-size:14px;color:#1e293b;z-index:100;}
    .left-panel h3{margin:0 0 10px;font-size:15px;color:#1e293b;}
    .gate-btns{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px;}
    .gate-btn{flex:1 1 45%;padding:6px 8px;background:#fff;border:1px solid #e2e8f0;border-radius:10px;font-size:12px;cursor:pointer;box-shadow:0 1px 3px rgba(0,0,0,.08);text-align:center;}
    .gate-btn:hover{background:#f8fafc;box-shadow:0 3px 8px rgba(0,0,0,.1);}
    .gate-list{display:flex;flex-wrap:wrap;gap:5px;margin:8px 0;max-height:80px;overflow-y:auto;}
    .gate-badge{display:flex;align-items:center;gap:5px;padding:3px 7px;background:#fff;border:1px solid #e2e8f0;border-radius:8px;font-family:ui-monospace,monospace;font-size:11px;box-shadow:0 1px 2px rgba(0,0,0,.06);}
    .gate-badge .remove{width:15px;height:15px;background:#ef4444;color:#fff;border:none;border-radius:50%;font-size:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
    .gate-badge .remove:hover{background:#dc2626;}
    .reset-circuit-btn{width:100%;margin-top:8px;padding:6px;background:#fff;border:1px solid #e2e8f0;border-radius:10px;font-size:12px;cursor:pointer;}
    .reset-circuit-btn:hover{background:#f8fafc;}


/* 左箭頭正三角形 */
#nextBtn::before {
    width: 3px;
    height: 3px;
    clip-path: polygon(100% 50%, 0% 0%, 0% 100%);
    background: #7a654f;
    margin-right:-3px;
}


/* 右箭頭正三角形 */
#prevBtn::before {
    width: 3px;
    height: 3px;
    clip-path: polygon(0% 50%, 100% 0%, 100% 100%);
    background: #7a654f;
    margin-right:3px;
}


/* hover 顏色 */
#prevBtn:hover::before { background: #fff; }
#nextBtn:hover::before { background: #fff; }


</style>
</head>
<body>
<div id="gameWrapper">
    <h2 style="margin:10px 0 5px;">貓貓星球</h2>
    <div id="container"><svg></svg></div>
    <div id="info">
        <div id="levelNumber">題目：1</div>
        <div id="steps">步數：0</div>
        <div id="timer">時間：0 秒</div>
    </div>
    <div id="buttons">
        <button id="prevBtn"></button>
        <button id="resetBtn">重新開始</button>
        <button id="nextBtn"></button>
    </div>
</div>








<div class="left-panel">
    <h3>選擇 BIT 數</h3>
    <select id="bitSelector">
        <option value="1">1 BIT</option>
        <option value="2" selected>2 BIT</option>
    </select>








    <h3 style="margin-top:10px;">新增量子閘門</h3>
    <div class="gate-btns">
        <button class="gate-btn" onclick="applyGateAndAnimate({type:'X', target:0})">X q0</button>
        <button class="gate-btn" onclick="applyGateAndAnimate({type:'X', target:1})">X q1</button>
        <button class="gate-btn" onclick="applyGateAndAnimate({type:'CNOT', control:0, target:1})">1CNOT q0->q1</button>
        <button class="gate-btn" onclick="applyGateAndAnimate({type:'CNOT', control:1, target:0})">1CNOT q1->q0</button>
        <!--<button class="gate-btn" onclick="applyGateAndAnimate({type:'SWAP', a:0, b:1})">SWAP 0 to 1</button>-->
        <button class="gate-btn" onclick="applyGateAndAnimate({type:'CNOT0_0to1'})">0CNOT q0->q1</button>
        <button class="gate-btn" onclick="applyGateAndAnimate({type:'CNOT0_1to0'})">0CNOT q1->q0</button>
    </div>
    <h3 style="margin-top:10px;">目前電路</h3>
    <div id="gateList" class="gate-list"></div>
    <button class="reset-circuit-btn" onclick="resetCircuit()">重設電路</button>
</div>








<div id="successPopup" class="popup">
  <div class="popup-content">
    <h2>Congratulations 成功！</h2>
    <p></p><br>
    <button id="closePopup">再玩一次</button>
  </div>
</div>








<script>
    const raw = "https://raw.githubusercontent.com/s112321005/little_prince/main/";
    const planetImg = { "3flower": raw+"3flower_00.png","Bob": raw+"Bob_01.png","Kurover": raw+"Kurover_10.png","doll": raw+"doll_11.png" };
    const fishImg = { "3flowerFish": raw+"3flowerFish.png","BobFish": raw+"BobFish.png","KuroFish": raw+"KuroFish.png","dollFish": raw+"dollFish%20.png" };
   
    let bitCount = 2;
    const bitLevels = {
        1:[{planets:[{id:"planet1", key:"3flower", top:140, left:20},{id:"planet2", key:"Bob", top:140, left:260}], princes:[{img: fishImg["3flowerFish"], target:"planet1"},{img: fishImg["BobFish"], target:"planet2"}], lines:[["line12","planet1","planet2"]]}],
        2:[...Array(23)].map((_,i)=>({planets:[{id:"planet1", key:"3flower", top:0, left:0},{id:"planet2", key:"Bob", top:0, left:280},{id:"planet3", key:"Kurover", top:280, left:0},{id:"planet4", key:"doll", top:280, left:280}], princes:[{img: fishImg["3flowerFish"], target:"planet1"},{img: fishImg["BobFish"], target:"planet2"},{img: fishImg["KuroFish"], target:"planet3"},{img: fishImg["dollFish"], target:"planet4"}], lines:[["line12","planet1","planet2"],["line13","planet1","planet3"],["line24","planet2","planet4"],["line34","planet3","planet4"]] }))
    };
   
    // 所有 4! 排列，排除 [0,1,2,3]
    const allPerms = (arr) => arr.length <= 1 ? [arr] : arr.flatMap((x,i)=>allPerms([...arr.slice(0,i),...arr.slice(i+1)]).map(p=>[x,...p]));
    const fixedArrangements = allPerms([0,1,2,3]).filter(p=>p.join("")!=="0123"); // 共 23 題
   
    let currentLevel=0, steps=0, startTime, timerInterval;
    let circuit=[], currentMap=[0,1,2,3];
    let planets={}, princes=[];
    const stepDisplay = document.getElementById("steps");
    const timerDisplay = document.getElementById("timer");
    const container = document.getElementById("container");
    const svg = container.querySelector("svg");
   
    function stateIndexToBits(i){ return i.toString(2).padStart(bitCount,"0").split("").map(Number); }
    function bitsToStateIndex(bits){ return parseInt(bits.join(""),2); }
    function applyGateToIndex(stateIndex, gate){
        const b = stateIndexToBits(stateIndex);
        const nb = b.slice();
        switch(gate.type){
            case "X":
                nb[gate.target] ^= 1;
                break;
            case "CNOT":
                if(nb[gate.control]) nb[gate.target] ^= 1;
                break;
            case "CNOT0_0to1":
                if(nb[0] === 0) nb[1] ^= 1;
                break;
            case "CNOT0_1to0":
                if(nb[1] === 0) nb[0] ^= 1;
                break;
        }
        return bitsToStateIndex(nb);
    }
   
    function addGateToList(g){ circuit.push(g); renderGateList(); }
    function resetCircuit(){ circuit=[]; currentMap=[0,1,2,3]; renderGateList(); softResetFish(); }
    function renderGateList(){
        const box = document.getElementById("gateList"); box.innerHTML="";
        circuit.forEach((g,idx)=>{
            const el = document.createElement("div"); el.className="gate-badge";
            el.innerHTML = `<span>${g.type==="X"?`X q${g.target}`:g.type==="CNOT"?`CNOT ${g.control} to ${g.target}`:g.type}</span>`;
            const x = document.createElement("button"); x.className="remove"; x.textContent="x";
            x.onclick = ()=>{circuit.splice(idx,1); renderGateList();};
            el.appendChild(x); box.appendChild(el);
        });
    }
   
    function applyGateAndAnimate(gate){
        addGateToList(gate);
        currentMap = currentMap.map(x => applyGateToIndex(x, gate));
        const perm = [0,1,2,3].map(i => applyGateToIndex(i, gate));
        perm.forEach((toIdx,fromIdx)=>{
            const planetList = getCurrentLevel().planets;
            if(fromIdx>=planetList.length||toIdx>=planetList.length) return;
            const pidFrom = planetList[fromIdx].id;
            const pidTo = planetList[toIdx].id;
            const fish = planets[pidFrom].querySelector(".person"); if(!fish) return;
            const r1 = planets[pidFrom].getBoundingClientRect();
            const r2 = planets[pidTo].getBoundingClientRect();
            const dx = r2.left - r1.left, dy = r2.top - r1.top;
            fish.style.transform = `translate(${dx}px,${dy}px) translate(-50%,-50%)`;
            setTimeout(()=>{planets[pidTo].appendChild(fish); fish.style.transform="translate(-50%,-50%)"; checkSuccess();},800);
        });
        steps++; stepDisplay.textContent=`步數：${steps}`;
    }
   
    function getCurrentLevel(){ return bitLevels[bitCount][currentLevel]; }
   
    function loadLevel(idx){
        document.getElementById("levelNumber").textContent = `題目：${idx+1}`;
        container.querySelectorAll(".planet").forEach(p=>p.remove());
        svg.innerHTML=""; planets={};
        princes = JSON.parse(JSON.stringify(getCurrentLevel().princes));
   
        getCurrentLevel().planets.forEach(p=>{
            const div=document.createElement("div"); div.className="planet"; div.id=p.id; div.style.top=p.top+"px"; div.style.left=p.left+"px";
            const img=document.createElement("img"); img.src=planetImg[p.key]; div.appendChild(img);
            container.appendChild(div); planets[p.id]=div;
        });
        getCurrentLevel().lines.forEach(([id,p1,p2])=>{
            const line=document.createElementNS("http://www.w3.org/2000/svg","line");
            const pl1=getCurrentLevel().planets.find(x=>x.id===p1);
            const pl2=getCurrentLevel().planets.find(x=>x.id===p2);
            line.setAttribute("x1",pl1.left+70); line.setAttribute("y1",pl1.top+70);
            line.setAttribute("x2",pl2.left+70); line.setAttribute("y2",pl2.top+70);
            line.style.stroke="#555"; line.style.strokeWidth=4; line.style.cursor="pointer";
            svg.appendChild(line);
            line.addEventListener("mouseenter",()=>{line.style.stroke="#ffcc00"; line.style.strokeWidth=8;});
            line.addEventListener("mouseleave",()=>{line.style.stroke="#555"; line.style.strokeWidth=4;});
            line.addEventListener("click",()=>swap(p1,p2));
        });
        steps=0; stepDisplay.textContent="步數：0";
        placePrincesByFixedArrangement(idx);
        startTimer();
    }
   
    function placePrincesByFixedArrangement(levelIdx){
    const keys = Object.keys(planets);
    Object.values(planets).forEach(p => p.querySelectorAll(".person").forEach(img => img.remove()));


    if (bitCount === 1) {
        // 1 bit：讓兩隻魚交換位置
        princes.forEach((prince, i) => {
            const img = document.createElement("img");
            img.src = prince.img;
            img.alt = "fish";
            img.className = "person";
            const planetId = keys[1 - i]; // 反過來放
            planets[planetId].appendChild(img);
        });
    } else {
        // 2 bit：使用排列表
        const arrangement = fixedArrangements[levelIdx];
        princes.forEach((prince, i) => {
            const img = document.createElement("img");
            img.src = prince.img;
            img.alt = "fish";
            img.className = "person";
            const planetId = keys[arrangement[i]];
            planets[planetId].appendChild(img);
        });
    }
}


   
    function swap(p1,p2){
        const a=planets[p1].querySelector(".person"); const b=planets[p2].querySelector(".person"); if(!a||!b) return;
        steps++; stepDisplay.textContent=`步數：${steps}`;
        const r1=planets[p1].getBoundingClientRect(); const r2=planets[p2].getBoundingClientRect();
        const dx=r2.left-r1.left, dy=r2.top-r1.top;
        a.style.transform=`translate(${dx}px,${dy}px) translate(-50%,-50%)`;
        b.style.transform=`translate(${-dx}px,${-dy}px) translate(-50%,-50%)`;
        setTimeout(()=>{planets[p1].appendChild(b); planets[p2].appendChild(a); a.style.transform=b.style.transform="translate(-50%,-50%)"; checkSuccess();},800);
    }
   
    function checkSuccess(){
        const ok=princes.every(prince=>{
            const img=planets[prince.target].querySelector(".person");
            return img && img.src===prince.img;
        });
        if(ok){clearInterval(timerInterval); showPopup(steps,Math.floor((Date.now()-startTime)/1000));}
    }
   
    function startTimer(){ clearInterval(timerInterval); startTime=Date.now(); timerInterval=setInterval(()=>{ timerDisplay.textContent=`時間：${Math.floor((Date.now()-startTime)/1000)} 秒`;},1000);}
    function showPopup(steps,sec){document.querySelector("#successPopup p").innerHTML=`哇！你走了 ${steps} 步，花了 ${sec} 秒，讓每隻貓都吃到對應的魚耶~`; document.getElementById("successPopup").style.display="flex";}
    function softResetFish(){steps=0; stepDisplay.textContent="步數：0"; placePrincesByFixedArrangement(currentLevel); startTimer();}
   
    document.getElementById("closePopup").onclick=()=>{document.getElementById("successPopup").style.display="none"; softResetFish();};
    document.getElementById("resetBtn").onclick=()=>{resetCircuit();};
    document.getElementById("bitSelector").onchange=(e)=>{bitCount=parseInt(e.target.value); currentLevel=0; loadLevel(currentLevel); resetCircuit();};
   
    let animating=false;
    function transitionLevel(nextIdx,dir){
        if(animating) return; animating=true;
        container.classList.add(dir==="left"?"slide-out-left":"slide-out-right");
        setTimeout(()=>{
            currentLevel=nextIdx;
            loadLevel(currentLevel);
            container.classList.remove("slide-out-left","slide-out-right");
            container.classList.add(dir==="left"?"slide-in-right":"slide-in-left");
            setTimeout(()=>{container.classList.remove("slide-in-right","slide-in-left"); animating=false;},620);
        },320);
    }
   
    document.getElementById("prevBtn").onclick=()=>{transitionLevel((currentLevel-1+bitLevels[bitCount].length)%bitLevels[bitCount].length,"left"); resetCircuit();};
    document.getElementById("nextBtn").onclick=()=>{transitionLevel((currentLevel+1)%bitLevels[bitCount].length,"right"); resetCircuit();};
   
    loadLevel(currentLevel);
    </script>
   
</body>
</html>





